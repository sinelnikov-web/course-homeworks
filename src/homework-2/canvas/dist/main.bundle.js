(()=>{"use strict";const t=new class{createEmptyCanvas(){const t=document.createElement("canvas");return{emptyCanvas:t,ctx:t.getContext("2d")};}grayscaleRGBAArray(t){for(let e=0;e<t.length;e+=4){let a=(t[e]+t[e+1]+t[e+2])/3;t[e]=a,t[e+1]=a,t[e+2]=a;}}invertRGBAArray(t){for(let e=0;e<t.length;e+=4)t[e]=255-t[e],t[e+1]=255-t[e+1],t[e+2]=255-t[e+2];}fetchImage(t){return new Promise(((e,a)=>{const h=new Image;h.crossOrigin="Anonymous",h.onload=()=>{e(h);},h.onerror=()=>{a(`Can't download the image from ${t}`);},h.src=t;}));}grayscaleFromUrl(t){return new Promise(((e,a)=>{const{emptyCanvas:h,ctx:r}=this.createEmptyCanvas();this.fetchImage(t).then((t=>{h.width=t.width,h.height=t.height,r.drawImage(t,0,0);let a=r.getImageData(0,0,t.width,t.height);this.grayscaleRGBAArray(a.data),e({data:a,width:t.width,height:t.height});})).catch(a);}));}grayscaleFromCanvas(t){const e=t.getContext("2d"),{emptyCanvas:a,ctx:h}=this.createEmptyCanvas();a.height=t.height,a.width=t.width,h.putImageData(e.getImageData(0,0,t.width,t.height),0,0);const r=h.getImageData(0,0,a.width,a.height);return this.grayscaleRGBAArray(r.data),r;}grayscaleFromImageData(t){const{emptyCanvas:e,ctx:a}=this.createEmptyCanvas();a.putImageData(t,0,0);const h=a.getImageData(0,0,e.width,e.height);return this.grayscaleRGBAArray(h.data),h;}invertFromUrl(t){return new Promise(((e,a)=>{const{emptyCanvas:h,ctx:r}=this.createEmptyCanvas();this.fetchImage(t).then((t=>{h.width=t.width,h.height=t.height,r.drawImage(t,0,0);let a=r.getImageData(0,0,t.width,t.height);this.invertRGBAArray(a.data),e({data:a,width:t.width,height:t.height});})).catch(a);}));}invertFromCanvas(t){const e=t.getContext("2d"),{emptyCanvas:a,ctx:h}=this.createEmptyCanvas();a.height=t.height,a.width=t.width,h.putImageData(e.getImageData(0,0,t.width,t.height),0,0);const r=h.getImageData(0,0,a.width,a.height);return this.invertRGBAArray(r.data),r;}invertFromImageData(t){const{emptyCanvas:e,ctx:a}=this.createEmptyCanvas();a.putImageData(t,0,0);const h=a.getImageData(0,0,e.width,e.height);return this.invertRGBAArray(h.data),h;}},e=document.querySelector("#normal"),a=document.querySelector("#grayscale"),h=document.querySelector("#inverted"),r="https://avatars.dzeninfra.ru/get-zen_doc/34175/pub_5cea2361585c2f00b5c9cb0b_5cea310a752e5b00b25b9c01/scale_1200",n=new Image;n.onload=()=>{const t=e.getContext("2d");e.width=n.width,e.height=n.height,t.drawImage(n,0,0);},n.src=r,t.grayscaleFromUrl(r).then((({data:t,width:e,height:h})=>{const r=a.getContext("2d");a.width=e,a.height=h,r.putImageData(t,0,0);})),t.invertFromUrl(r).then((({data:t,width:e,height:a})=>{const r=h.getContext("2d");h.width=e,h.height=a,r.putImageData(t,0,0);}));})();